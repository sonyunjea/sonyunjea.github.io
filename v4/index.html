
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>공룡 점프 게임</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background-color: #202124; /* 어두운 배경색 */
            color: #d7dadc; /* 밝은 텍스트 색 */
            touch-action: manipulation; /* 모바일에서 더블 탭 확대 방지 */
        }
        canvas {
            background-color: #202124;
            display: block;
        }
        .game-container {
            border-bottom: 2px solid #d7dadc;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl mx-auto text-center">
        <div id="ui" class="flex justify-between items-center mb-4 text-2xl">
            <div id="score-container">SCORE: <span id="score">0</span></div>
            <div id="highscore-container">HI: <span id="highscore">0</span></div>
        </div>
        
        <div class="game-container w-full aspect-[4/1] relative">
             <canvas id="gameCanvas"></canvas>
             <div id="startMessage" class="absolute inset-0 flex flex-col items-center justify-center text-3xl">
                <p>JUMP TO START</p>
                <p class="text-xl mt-2">(SPACE or TAP)</p>
            </div>
            <div id="gameOverMessage" class="absolute inset-0 flex-col items-center justify-center text-4xl hidden">
                <p>GAME OVER</p>
                <p class="text-xl mt-4">JUMP TO RESTART</p>
            </div>
        </div>
        <p class="mt-4 text-lg">스페이스바 또는 화면을 탭하여 점프하세요!</p>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const gameContainer = document.querySelector('.game-container');
        
        const scoreEl = document.getElementById('score');
        const highscoreEl = document.getElementById('highscore');
        const startMessageEl = document.getElementById('startMessage');
        const gameOverMessageEl = document.getElementById('gameOverMessage');

        let dino;
        let obstacles = [];
        let score = 0;
        let highscore = 0;
        let gameSpeed = 5;
        let gameSpeedIncrement = 0.001;
        let lastTime = 0;
        let obstacleTimer = 0;
        let randomObstacleInterval = 1000;
        let isGameOver = true;
        let isGameStarted = false;

        const DINO_COLOR = '#d7dadc';
        const OBSTACLE_COLOR = '#d7dadc';

        // 캔버스 크기 조절 함수
        function resizeCanvas() {
            canvas.width = gameContainer.clientWidth;
            canvas.height = gameContainer.clientHeight;
        }

        class Dino {
            constructor() {
                this.width = canvas.width * 0.05; // 캔버스 너비에 비례
                this.height = canvas.height * 0.25; // 캔버스 높이에 비례
                this.x = this.width;
                this.y = canvas.height - this.height;
                this.yVelocity = 0;
                this.gravity = 0.8;
                this.jumpForce = 18;
                this.groundY = canvas.height - this.height;
                this.isJumping = false;
            }

            draw() {
                ctx.fillStyle = DINO_COLOR;
                // 간단한 공룡 모양 그리기
                ctx.fillRect(this.x, this.y, this.width, this.height);
                // 눈
                ctx.fillStyle = '#202124';
                ctx.fillRect(this.x + this.width * 0.6, this.y + this.height * 0.2, this.width * 0.2, this.height * 0.2);
            }

            update() {
                if (this.isJumping) {
                    this.y -= this.yVelocity;
                    this.yVelocity -= this.gravity;
                    if (this.y >= this.groundY) {
                        this.y = this.groundY;
                        this.isJumping = false;
                        this.yVelocity = 0;
                    }
                }
                this.draw();
            }

            jump() {
                if (!this.isJumping && !isGameOver) {
                    this.isJumping = true;
                    this.yVelocity = this.jumpForce;
                }
            }
        }

        class Obstacle {
            constructor() {
                const sizeType = Math.random();
                if (sizeType < 0.33) { // 작은 선인장
                    this.width = canvas.width * 0.03;
                    this.height = canvas.height * 0.2;
                } else if (sizeType < 0.66) { // 중간 선인장
                    this.width = canvas.width * 0.05;
                    this.height = canvas.height * 0.25;
                } else { // 큰 선인장
                    this.width = canvas.width * 0.08;
                    this.height = canvas.height * 0.25;
                }
                this.x = canvas.width;
                this.y = canvas.height - this.height;
            }

            draw() {
                ctx.fillStyle = OBSTACLE_COLOR;
                ctx.fillRect(this.x, this.y, this.width, this.height);
            }

            update() {
                this.x -= gameSpeed;
                this.draw();
            }
        }

        function handleObstacles(deltaTime) {
            if (obstacleTimer > randomObstacleInterval) {
                obstacles.push(new Obstacle());
                randomObstacleInterval = Math.random() * (2000 - 1000) + 1000 - (gameSpeed * 50);
                obstacleTimer = 0;
            } else {
                obstacleTimer += deltaTime;
            }

            obstacles.forEach((obstacle, index) => {
                obstacle.update();

                // 화면 밖으로 나간 장애물 제거
                if (obstacle.x + obstacle.width < 0) {
                    obstacles.splice(index, 1);
                }

                // 충돌 감지
                if (
                    dino.x < obstacle.x + obstacle.width &&
                    dino.x + dino.width > obstacle.x &&
                    dino.y < obstacle.y + obstacle.height &&
                    dino.y + dino.height > obstacle.y
                ) {
                    gameOver();
                }
            });
        }
        
        function updateScore() {
            score++;
            scoreEl.textContent = String(score).padStart(5, '0');
            if (score > highscore) {
                highscore = score;
                highscoreEl.textContent = String(highscore).padStart(5, '0');
                localStorage.setItem('dino-highscore', highscore);
            }
        }

        function gameLoop(timestamp) {
            if (isGameOver) return;
            
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            dino.update();
            handleObstacles(deltaTime);
            updateScore();
            
            gameSpeed += gameSpeedIncrement;

            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            if (isGameOver) {
                isGameOver = false;
                isGameStarted = true;
                score = 0;
                gameSpeed = 5;
                obstacles = [];
                dino = new Dino();
                
                startMessageEl.classList.add('hidden');
                gameOverMessageEl.classList.add('hidden');
                
                lastTime = 0; // requestAnimationFrame 시작 전 초기화
                requestAnimationFrame(gameLoop);
            }
        }
        
        function gameOver() {
            if (!isGameOver) {
                isGameOver = true;
                gameOverMessageEl.classList.remove('hidden');
            }
        }
        
        function handleInput() {
            if (isGameOver) {
                startGame();
            }
            if (dino) {
                 dino.jump();
            }
        }

        // 초기화 함수
        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            highscore = localStorage.getItem('dino-highscore') || 0;
            highscoreEl.textContent = String(highscore).padStart(5, '0');

            document.addEventListener('keydown', e => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    handleInput();
                }
            });
            
            document.addEventListener('touchstart', e => {
                e.preventDefault();
                handleInput();
            });

            startMessageEl.classList.remove('hidden');
        }

        init();

    </script>
</body>
</html>
