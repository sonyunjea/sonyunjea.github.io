<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방치형 돈나무 키우기</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Jua', sans-serif;
            touch-action: manipulation; /* 모바일에서 더블 탭 확대 방지 */
        }
        #money-tree {
            font-size: 8rem; /* 🌳 이모지 크기 */
            cursor: pointer;
            user-select: none; /* 텍스트 선택 방지 */
            transition: transform 0.1s ease;
        }
        #money-tree:active {
            transform: scale(0.95);
        }
        .floating-text {
            position: absolute;
            font-size: 1.5rem;
            font-weight: bold;
            color: #facc15; /* 노란색 */
            animation: float-up 1s ease-out forwards;
            pointer-events: none; /* 클릭 이벤트 방해하지 않도록 */
        }
        @keyframes float-up {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(-80px);
                opacity: 0;
            }
        }
        .disabled-button {
            background-color: #4a5568 !important; /* 어두운 회색 */
            cursor: not-allowed !important;
        }
    </style>
</head>
<body class="bg-gray-800 text-white flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md mx-auto text-center bg-gray-900 p-6 rounded-2xl shadow-2xl border border-gray-700">
        
        <!-- 머니 디스플레이 -->
        <div class="mb-6">
            <h1 class="text-3xl font-bold text-yellow-400">💰 현재 자산 💰</h1>
            <p id="money-display" class="text-5xl my-2 break-all">0</p>
            <p class="text-xl text-gray-400">(초당 <span id="mps-display">0</span>원)</p>
        </div>

        <!-- 돈나무 -->
        <div id="tree-container" class="relative mb-8">
            <div id="money-tree">🌳</div>
        </div>

        <!-- 업그레이드 섹션 -->
        <div class="space-y-4">
            <h2 class="text-2xl font-bold">✨ 업그레이드 ✨</h2>
            <!-- 클릭 파워 업그레이드 -->
            <button id="click-upgrade" class="w-full bg-blue-600 hover:bg-blue-700 p-4 rounded-lg shadow-lg transition-all duration-200">
                <p class="font-bold text-lg">클릭 파워 강화 (Lv.<span id="click-level-display">1</span>)</p>
                <p>클릭당 <span id="click-power-display">1</span>원</p>
                <p>비용: <span id="click-cost-display">10</span>원</p>
            </button>
            <!-- 자동 생산 업그레이드 -->
            <button id="auto-upgrade" class="w-full bg-green-600 hover:bg-green-700 p-4 rounded-lg shadow-lg transition-all duration-200">
                <p class="font-bold text-lg">자동 생산 공장 (Lv.<span id="auto-level-display">0</span>)</p>
                <p>초당 <span id="auto-power-display">0.1</span>원 추가</p>
                <p>비용: <span id="auto-cost-display">25</span>원</p>
            </button>
        </div>
        
        <!-- 게임 저장/초기화 -->
        <div class="mt-8">
            <button id="reset-button" class="text-gray-500 hover:text-red-500 transition-colors">게임 초기화</button>
        </div>
    </div>

    <script>
        // DOM 요소 가져오기
        const moneyDisplay = document.getElementById('money-display');
        const mpsDisplay = document.getElementById('mps-display');
        const moneyTree = document.getElementById('money-tree');
        const treeContainer = document.getElementById('tree-container');

        const clickUpgradeBtn = document.getElementById('click-upgrade');
        const clickLevelDisplay = document.getElementById('click-level-display');
        const clickPowerDisplay = document.getElementById('click-power-display');
        const clickCostDisplay = document.getElementById('click-cost-display');

        const autoUpgradeBtn = document.getElementById('auto-upgrade');
        const autoLevelDisplay = document.getElementById('auto-level-display');
        const autoPowerDisplay = document.getElementById('auto-power-display');
        const autoCostDisplay = document.getElementById('auto-cost-display');
        
        const resetButton = document.getElementById('reset-button');

        // 게임 상태 변수
        let gameState = {
            money: 0,
            moneyPerSecond: 0,
            moneyPerClick: 1,
            clickUpgradeLevel: 1,
            clickUpgradeCost: 10,
            autoUpgradeLevel: 0,
            autoUpgradeCost: 25,
            autoPower: 0.1, // 한번 업그레이드 시 오르는 초당 생산량
        };

        // 게임 데이터 불러오기
        function loadGame() {
            const savedState = localStorage.getItem('moneyTreeSave');
            if (savedState) {
                gameState = JSON.parse(savedState);
            }
        }

        // 게임 데이터 저장하기
        function saveGame() {
            localStorage.setItem('moneyTreeSave', JSON.stringify(gameState));
        }

        // 숫자 포맷팅 (예: 1000 -> 1,000)
        function formatNumber(num) {
            return Math.floor(num).toLocaleString();
        }

        function formatDecimal(num) {
             if (num < 10) {
                return num.toFixed(1);
            }
            return formatNumber(num);
        }

        // UI 업데이트
        function updateUI() {
            moneyDisplay.textContent = formatNumber(gameState.money);
            mpsDisplay.textContent = formatDecimal(gameState.moneyPerSecond);

            clickLevelDisplay.textContent = gameState.clickUpgradeLevel;
            clickPowerDisplay.textContent = formatNumber(gameState.moneyPerClick);
            clickCostDisplay.textContent = formatNumber(gameState.clickUpgradeCost);

            autoLevelDisplay.textContent = gameState.autoUpgradeLevel;
            autoPowerDisplay.textContent = formatDecimal(gameState.autoPower);
            autoCostDisplay.textContent = formatNumber(gameState.autoUpgradeCost);
            
            // 버튼 활성화/비활성화
            updateButtonState(clickUpgradeBtn, gameState.money >= gameState.clickUpgradeCost);
            updateButtonState(autoUpgradeBtn, gameState.money >= gameState.autoUpgradeCost);
        }

        function updateButtonState(button, isEnabled) {
            if (isEnabled) {
                button.classList.remove('disabled-button');
                button.disabled = false;
            } else {
                button.classList.add('disabled-button');
                button.disabled = true;
            }
        }

        // 클릭 이벤트 핸들러
        moneyTree.addEventListener('click', (e) => {
            gameState.money += gameState.moneyPerClick;
            showFloatingText(e);
            updateUI();
        });

        // 클릭 시 뜨는 텍스트
        function showFloatingText(e) {
            const floatingText = document.createElement('div');
            floatingText.textContent = `+${formatNumber(gameState.moneyPerClick)}`;
            floatingText.className = 'floating-text';
            
            // 클릭 위치에 텍스트 표시
            const rect = treeContainer.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            floatingText.style.left = `${x}px`;
            floatingText.style.top = `${y}px`;

            treeContainer.appendChild(floatingText);

            // 애니메이션 종료 후 요소 제거
            setTimeout(() => {
                floatingText.remove();
            }, 1000);
        }

        // 클릭 파워 업그레이드
        clickUpgradeBtn.addEventListener('click', () => {
            if (gameState.money >= gameState.clickUpgradeCost) {
                gameState.money -= gameState.clickUpgradeCost;
                gameState.clickUpgradeLevel++;
                gameState.moneyPerClick = Math.ceil(gameState.moneyPerClick * 1.2);
                gameState.clickUpgradeCost = Math.ceil(gameState.clickUpgradeCost * 1.25);
                updateUI();
            }
        });

        // 자동 생산 업그레이드
        autoUpgradeBtn.addEventListener('click', () => {
            if (gameState.money >= gameState.autoUpgradeCost) {
                gameState.money -= gameState.autoUpgradeCost;
                gameState.autoUpgradeLevel++;
                gameState.moneyPerSecond += gameState.autoPower;
                gameState.autoUpgradeCost = Math.ceil(gameState.autoUpgradeCost * 1.2);
                gameState.autoPower = parseFloat((gameState.autoPower * 1.05).toFixed(2));
                updateUI();
            }
        });
        
        // 게임 초기화
        resetButton.addEventListener('click', () => {
            if (confirm('정말로 게임을 초기화하시겠습니까? 모든 진행 상황이 사라집니다.')) {
                localStorage.removeItem('moneyTreeSave');
                // 페이지를 새로고침하여 초기 상태로 되돌립니다.
                window.location.reload();
            }
        });
        

        // 메인 게임 루프 (1초마다 실행)
        setInterval(() => {
            gameState.money += gameState.moneyPerSecond;
            updateUI();
        }, 1000);
        
        // 10초마다 자동 저장
        setInterval(saveGame, 10000);

        // 초기화
        loadGame();
        updateUI();
    </script>
</body>
</html>
